# Bpi:Bit MicroPython 任务细节

| 编辑日期      | 编辑备注 | 编辑人 |
| ------------- | -------- | ------ |
| 2019年8月16日 | 初稿     | Juwan  |
| 2019年8月22日 | 补充细节 | Juwan  |

该文档将指导用户进行 MicroPython 任务书的开展工作流程。

BPI - BIT 硬件发展可能性变更：8M + ICM20948。

[TOC]

## 固件

虚拟机准备好 MicroPython 编译环境，合并各个仓库代码并修复编译。

- 官方最近已经合并双核，提供 SD card。
- 我们自己的仓库特殊 C 代码有
  - smartconfig
  - 定时器 timer（lobo）
  - webdav（移除）
  - 合并的蓝牙
  - 合并的 I2S
  - 未合并的有 wifi mesh => radio
- 将内置的 Python Code 移交到 sample 库当中，学习日本的板子固件，无需内置至固件。
- 测试固件内部文件系统，配套上传工具脚本，导出构建新固件。
- 确认 8M 固件编译，核对分区表，应对未来的新硬件。
- 内置 Python 驱动需要重构修复，添加单元测试、示例代码并扩充功能，做得更好，设计思路全部多线程处理。
  - 符合文档架构的 example 和严谨的自动化测试，接口暴露。
- 仓库重建，原 MicroPython 撤回，然后 Bpi-steam 重建合并代码 掌控板、日本板、旧版本等代码。

固件预计要重构，有一些 C 代码要迁移编译，额外考虑 8M 版本。

C 代码部分，可能要抽离，单独形成补丁包。

Python 部分学习日本的固件，示例库代码需要修正，尽量设计成多线程，释放 REPL 的形式。

先处理示例代码的情况，固件重整，清理固件内部内容，把示例代码导入后再重建固件。

添加 radio 广播功能，官方已经建立双核模式，剩下蓝牙优化至符合 microbit 接口。

### MicroBit 兼容部分

审视上一次的 MicroBit 接口能否做得更好？

完善遗留的一些问题，主要集中在 display 和 九轴的姿态检测，其他的待分析。

确保文档中的内容，在基础部分的示例没有走偏，可以正常使用。

遵循原则，可以释放 REPL 的就释放 REPL 尽量每个接口都可以多线程化。

### 内置代码 规范化

涉及到硬件的驱动代码，全面学习日本固件的测试代码，确认每个代码都可以被自动化测试，但不需要过去的文字注释了，只做内部测试用。

- display
- 九轴应用代码
- 其他相关的

 ### 添加更多功能

固件有原、官方、日本、lobo 的项目可以参考。

旧固件修订了 看门狗、定时器、MDNS、Smartconfig、Bluetooth、I2S。

官方修复了看门狗，动画，其他没有。

日本固件拉取了 radio 代码，可以引用。

双核已经启动，但 makefile 改动巨大，代码要编译需要修复，该死的官方。

如果不动固件架构，需要先剥离固件内置代码，通过 mpfshell 批量上传导入，然后再导出固件。

关了 debug 信息。

## 软件

将所有相关的软件全部收集起来，能用的都备好。

中间件用 mpfshell 部分充当控制，Editor 做一般入门基础过度，VSCODE 和 Pycharm 做进阶准备。

为 mpfshell 提供一个上传文件夹的接口。

软件有 editor 、mpfshell、vscode、pycharm 等 IDE 支持。

分阶段使用，第一阶段用 editor ， 第二阶段用 mpfshell + vscode ，第三阶段介绍 pycharm 就到头了。

## 文档

目录分类和整理，更利于使用，均指向指明固件。

分为基础文档、进阶文档、应用文档、开发文档等阶段。

基础文档主要交待内置硬件和软件的功能，以 editor 为例。

接着进阶问题照旧，只是把过去的运行过一遍，打上标记释出。

最后归档版本，软件和文档发布。

- 固件的烧写方法
- 软件的使用方法
- 内置的模块使用说明
- 示例代码的相关引用
- 根据 microbit 的文档情况复用

## 入口

再议。